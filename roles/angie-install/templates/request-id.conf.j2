# If the client sent an X-Request-ID header, it will be used.
# If the header is missing, a uniquely generated $request_id is used.

map $http_x_request_id $requestid {
    default $http_x_request_id;
    "" $request_id;
}

proxy_set_header X-Request-ID $requestid;
add_header X-Request-ID $requestid always;
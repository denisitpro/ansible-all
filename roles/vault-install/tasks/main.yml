---
- ansible.builtin.import_tasks: 05-create-folder.yml
  tags:
    - vault-install
    - vault-path

- ansible.builtin.import_tasks: 10-copy-ssl.yml
  when: vault_domain is defined and vault_domain == "selfsign"
  tags:
    - vault-install
    - vault-ssl

# - ansible.builtin.import_tasks: 15-copy-cert.yml
#   when: vault_domain is defined and vault_domain == "selfsign"
#   vars:
#     ssl_path: "{{ vault_conf_path }}/ssl"
#     ssl_cert_path: "{{ vault_conf_path }}/ssl/fullchain.pem"
#     ssl_privkey_path: "{{ vault_conf_path }}/ssl/privkey.pem"
#     ssl_ca_path: "{{ vault_conf_path }}/ca"
#     ssl_user: "{{ vault_uid }}"
#     ssl_group: "{{ vault_gid }}"
#   tags:
#     - vault-install
#     - vault-ssl
#     - vault-ssl-copy


- ansible.builtin.import_tasks: 20-config.yml
  tags:
    - vault-install
    - vault-config

- ansible.builtin.import_tasks: 25-copy-compose.yml
  tags:
    - vault-install
    - vault-compose

- ansible.builtin.import_tasks: 65-consul-reg.yml
  when: consul_monitoring_disable is not defined and consul_mon_vault_disable is not defined
  tags:
    - vault-install
    - consul
    - consul-reg
    - consul-owner
    - vault-consul-metrics


- ansible.builtin.import_tasks: 80-vault-clean.yml
  tags: ['never', 'vault-clean']

- ansible.builtin.import_tasks: 90-ssl-clean.yml
  vars:
    ssl_path: "{{ vault_conf_path }}/ssl"
    ssl_cert_path: "{{ vault_conf_path }}/ssl/fullchain.pem"
    ssl_privkey_path: "{{ vault_conf_path }}/ssl/privkey.pem"
  tags: ['never', 'ssl-clean']

---
- name: Create a directory if it does not exist
  file:
    path: /etc/dnsmasq.d/
    state: directory
    mode: '0755'

- name: copy base config
  template:
    src: "dnsmasq.conf.j2"
    dest: "/etc/dnsmasq.conf"
    owner: "root"
    group: "root"
    mode: 0644
  notify: restart dnsmasq
  tags:
    - config

- name: copy addition config
  template:
    src: "dns.conf.j2"
    dest: "/etc/dnsmasq.d/dns.conf"
    owner: "root"
    group: "root"
    mode: 0644
  notify: restart dnsmasq
  tags:
    - config

- name: Enable
  systemd:
    name: dnsmasq
    enabled: yes
    state: started
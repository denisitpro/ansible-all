---
- name: Check if docker-compose.yml exists
  when: redis_exporter_unit is not defined or not redis_exporter_unit | bool
  ansible.builtin.stat:
    path: "{{ redis_exporter_compose_path }}/docker-compose.yml"
  register: compose_file

- name: stop compose
  community.docker.docker_compose_v2:
    project_src: "{{ redis_exporter_compose_path }}"
    state: absent
  when: compose_file.stat.exists

- name: Remove directory data
  when: redis_exporter_unit is not defined or not redis_exporter_unit | bool
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  with_items:
    - "{{ redis_exporter_base_path }}"
    - "{{ redis_exporter_compose_path }}/docker-compose.yml"

- name: Remove redis_exporter binary
  when: redis_exporter_unit is defined and redis_exporter_unit | bool
  ansible.builtin.file:
    path: "{{ redis_exporter_bin_path }}"
    state: absent

- name: Stop and remove redis_exporter unit
  when: redis_exporter_unit is defined and redis_exporter_unit | bool
  ansible.builtin.systemd:
    name: "{{ redis_exporter_unit_name }}"
    state: stopped
    enabled: no
    daemon_reload: yes

---

- name: Install dependencies
  apt:
    name:
      - lvm2
      - corosync
      - drbd-utils
      - python3-pip
      - python3-pexpect
      - jq
    state: present
    update_cache: yes

- name: Add LINSTOR repository
  template:
    src: linstor.repo.j2
    dest: /etc/apt/sources.list.d/linstor.list

- name: Add GPG key
  shell: |
    curl -fsSL {{ linstor_repo_url }}/LINBIT-GPG-KEY | gpg --dearmor -o /usr/share/keyrings/linbit-keyring.gpg

- name: Update package cache
  apt:
    update_cache: yes

- name: Install LINSTOR components
  apt:
    name:
      - linstor-controller
      - linstor-satellite
      - linstor-client
    state: present
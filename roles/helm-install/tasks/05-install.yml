---
- name: Check for exist
  ansible.builtin.stat:
    path: "{{ helm_binary_path }}"
  register: binary_stat_result

- ansible.builtin.debug:
    msg: binary_stat_result -  {{ binary_stat_result }}

- name: Download helm
  ansible.builtin.get_url:
    url: "{{ helm_download_url }}"
    dest: "{{ helm_download_dir }}"
    mode: "0644"
  when: not binary_stat_result.stat.exists

- name: Unarchive helm  a file that is already on the remote machine
  ansible.builtin.unarchive:
    src: "{{ helm_download_dir }}/helm-{{ helm_version }}-linux-{{ go_arch }}.tar.gz"
    dest: "/tmp/"
    owner: root
    group: root
    remote_src: true
  when: not binary_stat_result.stat.exists

- name: Install  binary
  ansible.builtin.copy:
    src: "/tmp/linux-{{ go_arch }}/helm"
    dest: "{{ helm_binary_path }}"
    owner: root
    group: root
    mode: "0755"
    remote_src: true
  when: not binary_stat_result.stat.exists

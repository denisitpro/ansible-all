apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
kubernetesVersion: v{{k8s_cls_version}}
{% if k8s_cls_name is defined %}
controlPlaneEndpoint: "{{ k8s_cls_name |default('k8s.example.com') }}:{{ k8s_cls_port |default('6443') }}"
{% endif %}
networking:
  podSubnet: "10.48.0.0/21{% if k8s_ipv6 is defined %},fd00:10:48::/48{% endif %}"  # order ip4 first second ipv6 important
  serviceSubnet: "10.96.0.0/12{% if k8s_ipv6 is defined %},fd00:10:96::/108{% endif %}"  #order ip4 first second ipv6 important
apiServer:
  certSANs:
    - "{{ k8s_cls_name | default('k8s.example.com') }}"
    - "10.15.1.1"
    - "10.15.1.2"
    - "10.15.1.3"
    - "10.15.2.100"
  extraArgs:
#    advertise-address: "{{ master_ip }}"
    bind-address: "{{ master_ip }}"
#kubeProxy:
#  config:
#    kind: KubeProxyConfiguration
#    apiVersion: kubeproxy.config.k8s.io/v1alpha1
#    bindAddress: "{{ master_ip }}"
#    healthzBindAddress: "{{ master_ip }}"
#    healthzPort: "10256"
---
apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: "{{ master_ip }}"
  bindPort: 6443
nodeRegistration:
#  name: "k8s-01"
  kubeletExtraArgs:
    node-ip: "{{ master_ip }}"
    address: "{{ master_ip }}"
---
apiVersion: kubeproxy.config.k8s.io/v1alpha1
kind: KubeProxyConfiguration
{% if k8s_ipv6 is defined %}
mode: "ipvs"
ipvs:
  strictARP: true
{% endif %}
bindAddress: "{{ master_ip }}"
healthzBindAddress: "{{ master_ip }}"


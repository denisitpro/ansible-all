# ---
# # tasks/main.yml  (validation-only)
# # Purpose: ensure the dynamic inventory can be loaded and returns something sane

# - name: Ensure community.general collection is present
#   ansible.builtin.meta: require_collection
#   args:
#     name: community.general
#   # NOTE: if running from a clean env, pre-install via `ansible-galaxy collection install community.general`

# - name: Try to load dynamic inventory via CLI
#   ansible.builtin.command:
#     cmd: ansible-inventory -i env/c1-infra/group_vars/vpn_key_c1_infra/vars.yml --list
#   register: inv_raw
#   changed_when: false

# - name: Parse inventory JSON
#   ansible.builtin.set_fact:
#     inv_json: "{{ inv_raw.stdout | from_json }}"

# - name: Assert inventory structure is present
#   ansible.builtin.assert:
#     that:
#       - inv_json is mapping
#       - "'_meta' in inv_json"
#       - "'all' in inv_json"
#     fail_msg: "Failed to load inventory from Terraform remote state. Check AWS credentials/profile or S3 path."
#     success_msg: "Inventory from Terraform remote state looks valid."
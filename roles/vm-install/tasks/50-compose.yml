---
- name: copy compose file
  template:
    src: "docker-compose.vm.yml.j2"
    dest: "{{vm_compose_path}}/docker-compose.yml"
    mode: 0600
  register: __vm_docker_compose_file


# # todo rewrite use notify
# - name: Copy docker-compose file
#   ansible.builtin.template:
#     src: "docker-compose.vm.yml.j2"
#     dest: "{{ vm_docker_compose_path }}/docker-compose.yml"
#     mode: '0600'
#     owner: root
#     group: root
#   register: __vm_docker_compose_file

- name: Restart docker
  ansible.builtin.shell:
    cmd: "docker compose pull; docker compose down --remove-orphans; docker compose up -d"
  args:
    chdir: "{{ vm_compose_path }}"
  when: __vm_docker_compose_file.changed

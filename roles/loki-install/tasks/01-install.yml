---
- name: Copy file loki
  copy:
    src: "{{ download_dir }}/loki-linux-amd64"
    dest: "{{bin_path}}/loki"
    owner: root
    group: root
    mode: '0755'
    remote_src: yes

- name: copy config file
  template:
    src:  config.yaml.j2
    dest: "{{loki_config_path}}/config.yaml"
    mode: 0640
    owner: "{{app_run_user}}"
    group: "{{app_run_user}}"
  notify: restart loki


- name: copy systemd unit file
  template:
    src:  loki.service.j2
    dest: /etc/systemd/system/loki.service
    mode: 0644
    owner: root
    group: root
  notify: restart loki
  tags:
    - unit

- name: ensure loki service is enabled
  systemd:
    daemon_reload: true
    name: loki
    enabled: true